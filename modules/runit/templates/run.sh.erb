#!/bin/bash

exec 2>&1

# lolbash
exec chpst -u<%= user %> bash - <<COMMAND
HOME="\$(getent passwd "<%= user %>" | awk -F: '{print \$(NF-1)}')"
export HOME

rvm="\${HOME}/.rvm/scripts/rvm"

echo "Loading RVM"
[ -f "\$rvm" ] && . "\$rvm"

env | sort
cd <%= directory %>
pwd
if [ -f "Gemfile" ] ; then
  bundle install
  exec bundle exec <%= command %>
else
  exec <%= command %>
fi
COMMAND
