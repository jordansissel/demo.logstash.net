#!/bin/sh

# This is a dumb hack to get the puppet exec 'shell' provider to use bash instead.
# Only necessary because debian's /bin/sh is horribly under-featured.
exec bash - <<ENDOFSCRIPT

USER="\$(whoami)"
HOME="\$(getent passwd "\$USER" | awk -F: '{print \$(NF-1)}')"
export HOME

rvm="\${HOME}/.rvm/scripts/rvm"
. "\$rvm"

bundle install
exec bundle exec <%= command %>
ENDOFSCRIPT
